// 技能加成系统测试脚本
// Skill Gain Bonus System Test Script

[FUNCTION f_skillbonus_check]
// 查看当前加成状态
LOCAL.BonusHours=<TAG0.SKILLGAIN_BONUS_HOURS>
LOCAL.BonusMultiplier=<TAG0.SKILLGAIN_BONUS_MULTIPLIER>
LOCAL.BonusUsedMs=<TAG0.SKILLGAIN_BONUS_USED>
LOCAL.BonusMaxMs=<EVAL <LOCAL.BonusHours>*3600000>
LOCAL.BonusRemainingMs=<EVAL <LOCAL.BonusMaxMs>-<LOCAL.BonusUsedMs>>

IF (<LOCAL.BonusRemainingMs> <= 0)
    SYSMESSAGE 今日技能加成已用完，明天重置。
    RETURN
ENDIF

LOCAL.RemainingMinutes=<EVAL <LOCAL.BonusRemainingMs>/60000>
LOCAL.RemainingHours=<EVAL <LOCAL.RemainingMinutes>/60>
LOCAL.RemainingMins=<EVAL <LOCAL.RemainingMinutes>%60>

SYSMESSAGE ═══════════════════════════════
SYSMESSAGE 技能加成状态 (Skill Bonus Status)
SYSMESSAGE ═══════════════════════════════
SYSMESSAGE 加成倍率: <DLOCAL.BonusMultiplier>x
IF (<LOCAL.RemainingHours> > 0)
    SYSMESSAGE 剩余时间: <DLOCAL.RemainingHours>小时 <DLOCAL.RemainingMins>分钟
ELSE
    SYSMESSAGE 剩余时间: <DLOCAL.RemainingMins>分钟
ENDIF
SYSMESSAGE ═══════════════════════════════

[FUNCTION f_skillbonus_reset]
// 重置加成时间（GM命令）
IF (<ACCOUNT.PLEVEL> < 7)
    SYSMESSAGE 权限不足！
    RETURN
ENDIF

LOCAL.CurrentDay=<EVAL <SERV.DATETIME.YEAR>*10000+<SERV.DATETIME.MONTH>*100+<SERV.DATETIME.DAY>>
TAG.SKILLGAIN_BONUS_DAY=<DLOCAL.CurrentDay>
TAG.SKILLGAIN_BONUS_USED=0
TAG.SKILLGAIN_BONUS_LASTUPDATE=<SERV.TIME>
SYSMESSAGE 技能加成时间已重置！

[FUNCTION f_skillbonus_set]
// 设置自定义加成（GM命令）
// 用法: .f_skillbonus_set 小时数 倍率
IF (<ACCOUNT.PLEVEL> < 7)
    SYSMESSAGE 权限不足！
    RETURN
ENDIF

IF (<ARGV[0]> == 0) || (<ARGV[1]> == 0)
    SYSMESSAGE 用法: .f_skillbonus_set <小时数> <倍率>
    SYSMESSAGE 例如: .f_skillbonus_set 3 2 (3小时2倍加成)
    RETURN
ENDIF

LOCAL.CurrentDay=<EVAL <SERV.DATETIME.YEAR>*10000+<SERV.DATETIME.MONTH>*100+<SERV.DATETIME.DAY>>
TAG.SKILLGAIN_BONUS_HOURS=<ARGV[0]>
TAG.SKILLGAIN_BONUS_MULTIPLIER=<ARGV[1]>
TAG.SKILLGAIN_BONUS_DAY=<DLOCAL.CurrentDay>
TAG.SKILLGAIN_BONUS_USED=0
TAG.SKILLGAIN_BONUS_LASTUPDATE=<SERV.TIME>
SYSMESSAGE 技能加成已设置为: <ARGV[0]>小时 <ARGV[1]>倍

[FUNCTION f_skillbonus_vip]
// VIP玩家特殊加成示例
LOCAL.CurrentDay=<EVAL <SERV.DATETIME.YEAR>*10000+<SERV.DATETIME.MONTH>*100+<SERV.DATETIME.DAY>>
TAG.SKILLGAIN_BONUS_HOURS=4
TAG.SKILLGAIN_BONUS_MULTIPLIER=3
TAG.SKILLGAIN_BONUS_DAY=<DLOCAL.CurrentDay>
TAG.SKILLGAIN_BONUS_USED=0
TAG.SKILLGAIN_BONUS_LASTUPDATE=<SERV.TIME>
SYSMESSAGE ═══════════════════════════════
SYSMESSAGE VIP特权已激活！
SYSMESSAGE 每日4小时3倍技能加成！
SYSMESSAGE ═══════════════════════════════

[FUNCTION f_skillbonus_newbie]
// 新手玩家特殊加成示例
IF (<ACCOUNT.TOTALCONNECTTIME> > 600)
    SYSMESSAGE 此加成仅限新手玩家（游戏时间少于10小时）
    RETURN
ENDIF

LOCAL.CurrentDay=<EVAL <SERV.DATETIME.YEAR>*10000+<SERV.DATETIME.MONTH>*100+<SERV.DATETIME.DAY>>
TAG.SKILLGAIN_BONUS_HOURS=24
TAG.SKILLGAIN_BONUS_MULTIPLIER=5
TAG.SKILLGAIN_BONUS_DAY=<DLOCAL.CurrentDay>
TAG.SKILLGAIN_BONUS_USED=0
TAG.SKILLGAIN_BONUS_LASTUPDATE=<SERV.TIME>
SYSMESSAGE ═══════════════════════════════
SYSMESSAGE 新手加成已激活！
SYSMESSAGE 每日24小时5倍技能加成！
SYSMESSAGE ═══════════════════════════════

[FUNCTION f_skillbonus_weekend]
// 周末特殊加成示例
LOCAL.DayOfWeek=<SERV.DATETIME.DAYOFWEEK>
IF (<LOCAL.DayOfWeek> != 0) && (<LOCAL.DayOfWeek> != 6)
    SYSMESSAGE 周末加成仅在周六和周日有效！
    RETURN
ENDIF

LOCAL.CurrentDay=<EVAL <SERV.DATETIME.YEAR>*10000+<SERV.DATETIME.MONTH>*100+<SERV.DATETIME.DAY>>
TAG.SKILLGAIN_BONUS_HOURS=6
TAG.SKILLGAIN_BONUS_MULTIPLIER=2
TAG.SKILLGAIN_BONUS_DAY=<DLOCAL.CurrentDay>
TAG.SKILLGAIN_BONUS_USED=0
TAG.SKILLGAIN_BONUS_LASTUPDATE=<SERV.TIME>
SYSMESSAGE ═══════════════════════════════
SYSMESSAGE 周末加成已激活！
SYSMESSAGE 每日6小时2倍技能加成！
SYSMESSAGE ═══════════════════════════════

// 自动应用示例 - 在sphere_serv_triggers.scp中添加
[FUNCTION f_onchar_login_bonus]
// 在 @Login 触发器中调用此函数

// 如果是新的一天（零点后）或首次登录，初始化加成
LOCAL.CurrentDay=<EVAL <SERV.DATETIME.YEAR>*10000+<SERV.DATETIME.MONTH>*100+<SERV.DATETIME.DAY>>
LOCAL.LastBonusDay=<TAG0.SKILLGAIN_BONUS_DAY>

IF (<LOCAL.CurrentDay> != <LOCAL.LastBonusDay>) || (<LOCAL.LastBonusDay> == 0)
    TAG.SKILLGAIN_BONUS_DAY=<DLOCAL.CurrentDay>
    TAG.SKILLGAIN_BONUS_USED=0
    TAG.SKILLGAIN_BONUS_LASTUPDATE=<SERV.TIME>
    
    // 如果没有设置加成参数，使用默认值
    IF (<TAG0.SKILLGAIN_BONUS_HOURS> == 0)
        TAG.SKILLGAIN_BONUS_HOURS=2
    ENDIF
    IF (<TAG0.SKILLGAIN_BONUS_MULTIPLIER> == 0)
        TAG.SKILLGAIN_BONUS_MULTIPLIER=2
    ENDIF
ENDIF

// 显示剩余加成时间
f_skillbonus_check

[EOF]
